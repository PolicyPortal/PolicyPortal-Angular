
<div class="requests-table-container1">
  <div class="wallet-section">
    <h2 class="heading">Wallet Management</h2>
    <!-- <div class="wallet-card">
      <div class="balance-info">
        <span class="balance-amount">
        </span>
        <span class="balance-amount">
  @if (selectedDealerInfo(); as info) {
    <span style="color: white; font-size: 1.3rem;">{{ info.dealerName }}</span>
    <div>₹ {{ info.dealerBalance | number: '1.2-2' }}</div>
  } @else {
    <span style="color: white;">Please select a dealer to view their balance.</span>
  }
</span>
      </div>
      <div class="col-12 col-md-6 col-lg-4">
              <select id="dealerBalanceSelect" class="form-select" 
                      [value]="selectedDealerBalance()" 
                      (change)="selectedDealerBalance.set($any($event.target).value)">
                <option value="All">Select a Dealer</option>
                @for (dealer of dealers(); track dealer) {
                  <option [value]="dealer">{{ dealer }}</option>
                }
              </select>
            </div>
    </div> -->
  </div>
</div>
         <!-- NEW: Dealer Balances Section -->
        <!-- <div class="dealer-balances-section mb-5">
          <h3 class="h3 text-secondary mb-4">Dealer Balances</h3>
          <div class="row g-4 align-items-end">
            <div class="col-12 col-md-6 col-lg-8">
              @if (selectedDealerInfo(); as dealer) {
                <div class="balance-card bg-white p-4 rounded-3 shadow-sm">
                  <span class="dealer-name text-muted small fw-medium d-block">{{ dealer.name }}</span>
                  <span class="dealer-balance h3 fw-bold text-dark d-block mt-1">
                    ₹ {{ dealer.balance | number: '1.2-2' }}
                  </span>
                </div>
              } @else {
                <div class="balance-card bg-white p-4 rounded-3 shadow-sm text-muted">
                  Please select a dealer to view their balance.
                </div>
              }
            </div>
            <div class="col-12 col-md-6 col-lg-4">
              <label for="dealerBalanceSelect" class="form-label small fw-medium text-dark mb-1">Select Dealer</label>
              <select id="dealerBalanceSelect" class="form-select" 
                      [value]="selectedDealerBalance()" 
                      (change)="selectedDealerBalance.set($any($event.target).value)">
                <option value="All">Select a Dealer</option>
                @for (dealer of dealers(); track dealer) {
                  <option [value]="dealer">{{ dealer }}</option>
                }
              </select>
            </div>
          </div>
        </div> -->

      <!-- NEW: Dealer Balances Section -->
      <!-- <div class="dealer-balances-section mb-5">
        <h3 class="h3 text-secondary mb-4">Dealer Balances</h3>
        <div class="row row-cols-1 row-cols-sm-2 row-cols-lg-3 row-cols-xl-4 g-4">
          @for (dealer of dealerBalances(); track dealer.name) {
            <div class="col">
              <div class="balance-card bg-white p-4 rounded-3 shadow-sm h-100">
                <span class="dealer-name text-muted small fw-medium d-block">{{ dealer.name }}</span>
                <span class="dealer-balance h3 fw-bold text-dark d-block mt-1">
                  ₹ {{ dealer.balance | number: '1.2-2' }}
                </span>
              </div>
            </div>
          }
        </div>
      </div> -->

      <!-- Filter Section -->
      <div class="bg-white p-4 rounded-3 shadow-sm mb-2">
        <div class="row g-4">
          
          <div class="col-md-4">
            <label for="transactionRefId" class="form-label small fw-medium text-dark mb-1">Transaction Ref No</label>
            <div class="input-container">
              <input type="text" id="transactionRefId" placeholder="Enter a Topup Id" 
                     class="form-control"
                     [value]="filterRefNo()"
                     (input)="filterRefNo.set($any($event.target).value)">
            </div>
          </div>
          
          <!-- New Dealer Filter -->
          <div class="col-md-4">
            <label for="dealer" class="form-label small fw-medium text-dark mb-1">Dealer</label>
            <div class="input-container">
              <select id="dealer" class="form-select"
                      [value]="filterDealer()"
                      (change)="filterDealer.set($any($event.target).value)">
                <option value="All">All Dealers</option>
                @for (dealer of dealers(); track dealer) {
                  <option [value]="dealer">{{ dealer }}</option>
                }
              </select>
            </div>
          </div>

          <div class="col-md-4">
            <label for="status" class="form-label small fw-medium text-dark mb-1">Status</label>
            <div class="input-container">
              <select id="status" class="form-select"
                      [value]="filterStatus()"
                      (change)="filterStatus.set($any($event.target).value)">
                <option value="All">All</option>
                <option value="approved">Approved</option>
                <option value="Pending">Pending</option>
                <option value="Rejected">Rejected</option>
              </select>
            </div>
          </div>
          
          <!-- <div class="col-md-3">
            <label for="dateRange" class="form-label small fw-medium text-dark mb-1">Date Range</label>
            <div class="input-container">
              <input type="date" id="dateRange" class="form-control"
                     [value]="filterDate()"
                     (input)="filterDate.set($any($event.target).value)">
            </div>
          </div> -->
        </div>
        
        <!-- Button container updated -->
        <div class="d-flex justify-content-end gap-2 mt-4">
          <button (click)="resetFilters()" class="btn btn-light px-4 py-2 rounded-pill fw-medium">
            Reset
          </button>
          <button (click)="applyFilters()" class="btn btn-primary px-4 py-2 rounded-pill fw-medium">
            Search
          </button>
          <!-- Export Button Moved Here -->
          <!-- <button class="export-button btn btn-dark px-4 py-2 rounded-pill fw-medium d-flex align-items-center gap-2">
            <span>Export</span>
          </button> -->
        </div>
      </div>

      <!-- Table Container -->
      <div class="bg-white rounded-3 shadow-sm overflow-hidden">
        <!-- table-responsive makes the table scroll horizontally on small screens -->
        <div class="table-responsive">
          <table class="requests-table table table-hover w-100 mb-0">
            <thead class="table-light">
              <tr>
                <th class="p-3 text-left small fw-semibold text-secondary text-uppercase">Transaction Date</th>
                <th class="p-3 text-left small fw-semibold text-secondary text-uppercase">Transaction Ref No</th>
                <th class="p-3 text-left small fw-semibold text-secondary text-uppercase">Dealer</th>
                <th class="p-3 text-left small fw-semibold text-secondary text-uppercase">Payment Mode</th>
                <th class="p-3 text-left small fw-semibold text-secondary text-uppercase">Amount</th>
                <th class="p-3 text-left small fw-semibold text-secondary text-uppercase">Status</th>
                <th class="p-3 text-left small fw-semibold text-secondary text-uppercase">Attachment</th>
                <th class="p-3 text-left small fw-semibold text-secondary text-uppercase">Submit Date</th>
                <th class="p-3 text-left small fw-semibold text-secondary text-uppercase">Update Date</th>
                <th class="p-3 text-left small fw-semibold text-secondary text-uppercase">Actions</th>
              </tr>
            </thead>
            <tbody>
               @if (isLoading()) {
          <tr>
            <td [attr.colspan]="18" class="text-center p-5">
              <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Loading </span>
              </div>
              <div class="text-muted mt-2">Loading transactions...</div>
            </td>
          </tr>
        }
              <!-- Updated @for to use filteredTransactions() -->
              @for (tx of filteredTransactions(); track tx.transaction_ref_no) {
                <tr>
                  <td class="p-3 align-middle text-nowrap">
                    <span class="date-text d-block">{{ tx.transaction_date | date: 'MM-dd-yyyy' }}</span>
                    <span class="time-text small text-muted d-block">{{ tx.transaction_date | date: 'HH:mm:ss' }}</span>
                  </td>
                  <td class="p-3 align-middle text-nowrap">{{ tx.transaction_ref_no }}</td>
                  <td class="p-3 align-middle fw-medium text-nowrap">{{ tx.dealer_name }}</td>
                  <td class="p-3 align-middle text-nowrap">{{ tx.payment_mode }}</td>
                  <td class="p-3 align-middle fw-medium text-nowrap">₹ {{ tx.amount | number: '1.2-2' }}</td>
                  <td class="p-3 align-middle text-nowrap">
                    <!-- Using Bootstrap Badges -->
                    <span class="badge rounded-pill fs-7 fw-medium"
                          [class]="tx.status?.toLowerCase() === 'approved' ? 'bg-success-subtle text-success-emphasis' : 
                                   (tx.status?.toLowerCase() === 'pending' ? 'bg-warning-subtle text-warning-emphasis' : 
                                   'bg-danger-subtle text-danger-emphasis')">
                      {{ tx.status }}
                    </span>
                  </td>
                  <td class="p-3 align-middle text-nowrap">
                    <!-- Using a link for the attachment -->
                    <a href="#" class="text-decoration-none">{{ tx.payment_proof_url }}</a>
                  </td>
                  <td class="p-3 align-middle text-nowrap">
                    <span class="date-text d-block">{{ tx.submit_date | date: 'MM-dd-yyyy' }}</span>
                    <span class="time-text small text-muted d-block">{{ tx.submit_date | date: 'HH:mm:ss' }}</span>
                  </td>
                  <td class="p-3 align-middle text-nowrap">
                    <span class="date-text d-block">{{ tx.update_date | date: 'MM-dd-yyyy' }}</span>
                    <span class="time-text small text-muted d-block">{{ tx.update_date | date: 'HH:mm:ss' }}</span>
                  </td>
                  <!-- New Actions Column -->
                  <td class="p-3 align-middle text-nowrap">
                    @if (tx.status?.toLowerCase() === 'pending') {
                      <div class="d-flex gap-3">
                        <!-- Using link-style buttons for actions -->
                        <button (click)="approveTransaction(tx.transaction_ref_no)" 
                                class="btn btn-link btn-sm p-0 text-success fw-medium text-decoration-none">Approve</button>
                        <button (click)="rejectTransaction(tx.transaction_ref_no)"
                                class="btn btn-link btn-sm p-0 text-danger fw-medium text-decoration-none">Reject</button>
                      </div>
                    } @else {
                      <span class="text-muted">N/A</span>
                    }
                  </td>
                </tr>
              }
            </tbody>
          </table>
        </div>
      </div>
    <!-- </div> -->
    
  <!-- </div> -->