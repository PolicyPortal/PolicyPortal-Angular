<div class="requests-table-container1">
  <div class="wallet-section">
    <h2 class="wallet-heading">Wallet</h2>
    <div class="wallet-card">
      <div class="balance-info">
        <span class="balance-label">Your Balance</span>
        <span class="balance-amount">₹ {{ walletBalance() | number:'1.2-2' }}</span>
      </div>
      <button class="add-balance-button" (click)="openModal()">+ Add Balance</button>
    </div>
  </div>
</div>

<!-- <div class="requests-table-container mt-3">
  <div class="table-header">
    <h2>Requests Table</h2>
    <button class="export-button">Export</button>
  </div> -->

  
      <!-- Filter Section -->
      <div class="bg-white p-4 rounded-3 shadow-sm mb-2">
        <div class="row g-4">
          
          <div class="col-md-4">
            <label for="transactionRefId" class="form-label small fw-medium text-dark mb-1">Transaction Ref No</label>
            <div class="input-container">
              <input type="text" id="transactionRefId" placeholder="Enter a Topup Id" 
                     class="form-control"
                     [value]="filterRefNo()"
                     (input)="filterRefNo.set($any($event.target).value)">
            </div>
          </div>
          
          <!-- New Dealer Filter -->
          <!-- <div class="col-md-3">
            <label for="dealer" class="form-label small fw-medium text-dark mb-1">Dealer</label>
            <div class="input-container">
              <select id="dealer" class="form-select"
                      [value]="filterDealer()"
                      (change)="filterDealer.set($any($event.target).value)">
                <option value="All">All Dealers</option>
                @for (dealer of dealers(); track dealer) {
                  <option [value]="dealer">{{ dealer }}</option>
                }
              </select>
            </div>
          </div> -->

          <div class="col-md-4">
            <label for="status" class="form-label small fw-medium text-dark mb-1">Status</label>
            <div class="input-container">
              <select id="status" class="form-select"
                      [value]="filterStatus()"
                      (change)="filterStatus.set($any($event.target).value)">
                <option value="All">All</option>
                <option value="approved">Approved</option>
                <option value="Pending">Pending</option>
                <option value="Rejected">Rejected</option>
              </select>
            </div>
          </div>
          
          <div class="col-md-4">
            <label for="dateRange" class="form-label small fw-medium text-dark mb-1">Date Range</label>
            <div class="input-container">
              <input type="date" id="dateRange" class="form-control"
                     [value]="filterDate()"
                     (input)="filterDate.set($any($event.target).value)">
            </div>
          </div>
        </div>
        
        <!-- Button container updated -->
        <div class="d-flex justify-content-end gap-2 mt-4">
          <button (click)="resetFilters()" class="btn btn-light px-4 py-2 rounded-pill fw-medium">
            Reset
          </button>
          <button (click)="applyFilters()" class="btn btn-primary px-4 py-2 rounded-pill fw-medium">
            Search
          </button>
          <!-- Export Button Moved Here -->
          <!-- <button class="export-button btn btn-dark px-4 py-2 rounded-pill fw-medium d-flex align-items-center gap-2">
            <span>Export</span>
          </button> -->
        </div>
      </div>

      <!-- Table Container -->
      <div class="bg-white rounded-3 shadow-sm overflow-hidden">
        <!-- table-responsive makes the table scroll horizontally on small screens -->
        <div class="table-responsive">
          <table class="requests-table table table-hover w-100 mb-0">
            <thead class="table-light">
              <tr>
                <th class="p-3 text-left small fw-semibold text-secondary text-uppercase">Transaction Date</th>
                <th class="p-3 text-left small fw-semibold text-secondary text-uppercase">Transaction Ref No</th>
                <!-- <th class="p-3 text-left small fw-semibold text-secondary text-uppercase">Dealer</th> -->
                <th class="p-3 text-left small fw-semibold text-secondary text-uppercase">Payment Mode</th>
                <th class="p-3 text-left small fw-semibold text-secondary text-uppercase">Amount</th>
                <th class="p-3 text-left small fw-semibold text-secondary text-uppercase">Status</th>
                <th class="p-3 text-left small fw-semibold text-secondary text-uppercase">Attachment</th>
                <th class="p-3 text-left small fw-semibold text-secondary text-uppercase">Submit Date</th>
                <th class="p-3 text-left small fw-semibold text-secondary text-uppercase">Update Date</th>
              </tr>
            </thead>
            <tbody>
              <!-- Updated @for to use filteredTransactions() -->
              @for (tx of filteredTransactions(); track tx.transaction_ref_no) {
                <tr>
                  <td class="p-3 align-middle text-nowrap">
                    <span class="date-text d-block">{{ tx.transaction_date | date: 'MM-dd-yyyy' }}</span>
                    <span class="time-text small text-muted d-block">{{ tx.transaction_date | date: 'HH:mm:ss' }}</span>
                  </td>
                  <td class="p-3 align-middle text-nowrap">{{ tx.transaction_ref_no }}</td>
                  <!-- <td class="p-3 align-middle fw-medium text-nowrap">{{ tx.dealerName }}</td> -->
                  <td class="p-3 align-middle text-nowrap">{{ tx.payment_mode }}</td>
                  <td class="p-3 align-middle fw-medium text-nowrap">₹ {{ tx.amount | number: '1.2-2' }}</td>
                  <td class="p-3 align-middle text-nowrap">
                    <!-- Using Bootstrap Badges -->
                    <span class="badge rounded-pill fs-7 fw-medium"
                          [class]="tx.status?.toLowerCase() === 'approved' ? 'bg-success-subtle text-success-emphasis' : 
                                   (tx.status?.toLowerCase() === 'pending' ? 'bg-warning-subtle text-warning-emphasis' : 
                                   'bg-danger-subtle text-danger-emphasis')">
                      {{ tx.status }}
                    </span>
                  </td>
                  <td class="p-3 align-middle text-nowrap">
                    <!-- Using a link for the attachment -->
                    <a href="#" class="text-decoration-none">{{ tx.payment_proof_url || '--' }}</a>
                  </td>
                  <td class="p-3 align-middle text-nowrap">
                    <span class="date-text d-block">{{ tx.submit_date | date: 'MM-dd-yyyy' }}</span>
                    <span class="time-text small text-muted d-block">{{ tx.submit_date | date: 'HH:mm:ss' }}</span>
                  </td>
                  <td class="p-3 align-middle text-nowrap">
                    <span class="date-text d-block">{{ tx.update_date | date: 'MM-dd-yyyy' }}</span>
                    <span class="time-text small text-muted d-block">{{ tx.update_date | date: 'HH:mm:ss' }}</span>
                  </td>
                </tr>
              }
            </tbody>
          </table>
        </div>
      <!-- </div> -->
    <!-- </div> -->
    
  <!-- </div> -->

<!-- Modal -->
<div class="modal-overlay" [class.hidden]="!isModalVisible()">
  <div class="modal1">
    <div class="modal-header">
      <h3 class="modal-title">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor">
          <path
            d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"
          />
        </svg>
        Payment Details
      </h3>
      <button class="modal-close" (click)="closeModal()">&times;</button>
    </div>
    <div class="modal-body">
      <p class="modal-subtitle">Kindly enter the details of your payment.</p>

      <form
        [formGroup]="walletForm"
        (ngSubmit)="submitTopup()"
        class="payment-form"
        enctype="multipart/form-data"
      >
        <div class="form-row">
          <div class="form-group">
            <label for="paymentMode">Payment Mode *</label>
            <select id="paymentMode" formControlName="paymentMode" class="form-input">
              <option [ngValue]="null" disabled selected>-- SELECT PAYMENT MODE --</option>
              <option *ngFor="let mode of paymentModes" [value]="mode">{{ mode }}</option>
            </select>
          </div>
          <div class="form-group">
            <label for="paymentProofFile">Payment Proof File *</label>
            <input
              type="file"
              id="paymentProofFile"
              (change)="onFileChange($event)"
              class="form-control"
            />
          </div>


        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="transactionDate">Transaction Date *</label>
            <input
              id="transactionDate"
              type="date"
              formControlName="transactionDate"
              class="form-input"
            />
          </div>
          <div class="form-group">
            <label for="updateDate">Update Date *</label>
            <input
              id="updateDate"
              type="date"
              formControlName="updateDate"
              class="form-input"
            />
          </div>
        </div>

        <div class="form-row full-width">
          <div class="form-group">
            <label for="transactionRefNo">Transaction Reference No. *</label>
            <input
              id="transactionRefNo"
              type="text"
              formControlName="transactionRefNo"
              class="form-input"
              placeholder="Enter Transaction Reference No."
            />
          </div>
        </div>

        <div class="form-row full-width">
          <div class="form-group">
            <label for="amount">Amount ( in ₹ ) *</label>
            <input
              id="amount"
              type="text"
              formControlName="amount"
              class="form-input"
              placeholder="Enter Transaction Amount"
            />
          </div>
        </div>

        <button type="submit" class="submit-button" [disabled]="walletForm.invalid">
          Add Balance
        </button>
      </form>

      
    </div>
  </div>
</div>
